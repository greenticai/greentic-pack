PR-02 — greentic-pack resolve (writes pack.lock.json using greentic-distributor-client)

Goal: Actually resolve remote refs → digests and produce lockfile deterministically.

Scope

Add new command: greentic-pack resolve

Inputs:

pack.yaml + discovered flows + sidecars

Behavior:

collect all component sources from sidecars

for each remote ref (oci/repo/store):

call greentic-distributor-client DistClient.resolve_ref

write digest into pack.lock.json

for local paths:

optionally compute sha256 and store as a “local” lock entry, or store under a separate locals section (choose one; I recommend include locals too)

Deliverables

Command + output JSON structure exactly:

{ "schema_version": 1, "components": [ { "name", "ref", "digest" } ] }


Flags:

--offline honored

--lock <path> optional (default pack.lock.json)

Tests:

No network. Use file/http fixture resolver support in distributor-client or mock resolver trait injected behind a feature.

“offline blocks resolve when digest missing”

✅ End state: greentic-pack resolve works and is test-covered.