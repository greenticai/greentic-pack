# PR-04.md (greentic-pack OR pack builder/validator repo)
# Title: Validate provider extension + strict pinning

## Goal
Add generic support for `PackManifest.extensions` with a known extension kind:
- `"greentic.ext.provider"`

Validate its shape without hardcoding provider categories.

## Provider extension inline shape (JSON)
`extensions["greentic.ext.provider"].inline` should be:
```json
{
  "providers": [
    {
      "provider_type": "messaging.telegram.bot",
      "capabilities": ["send", "receive"],
      "ops": ["send", "reply"],
      "config_schema_ref": "schemas/messaging/telegram/config.schema.json",
      "state_schema_ref": "schemas/messaging/telegram/state.schema.json",
      "runtime": {
        "component_ref": "telegram-provider",
        "export": "provider",
        "world": "greentic:provider/schema-core@1.0.0"
      },
      "docs_ref": "schemas/messaging/telegram/README.md"
    }
  ]
}
Tasks

Parse extensions

Update manifest loader to parse extensions using greentic-types changes (PR-01).

Provider extension validation

If greentic.ext.provider exists:

confirm inline.providers[] exists and fields are present

validate runtime.world == "greentic:provider/schema-core@1.0.0"

Strict mode

Add env flag GREENTIC_PACK_STRICT_EXTENSIONS=1

In strict mode:

if location set, require digest

allowlist location schemes:

oci://, file:// (and optionally https:// only with digest)

Docs

Add docs/provider_extension.md

Tests

fixtures:

inline provider extension valid

inline provider extension missing required fields (fail)

remote extension no digest (strict fail)

ensure unknown extension kinds do not fail

Acceptance criteria

Provider extension is validated generically.

Strict mode enforces deterministic pinning.

No domain/provider hardcoding.